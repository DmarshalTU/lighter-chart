apiVersion: apps/v1
kind: Deployment
metadata:
    namespace: spark
    name: lighter
spec:
    selector:
        matchLabels:
            run: lighter
    replicas: 1
    strategy:
        rollingUpdate:
            maxUnavailable: 0
            maxSurge: 1
    template:
        metadata:
            labels:
                run: lighter
        spec:
            containers:
                -   image: sasnouskikh/livy:0.8.0-incubating-spark_3.0.1_2.12-hadoop_3.2.0_cloud
                    name: lighter
                    readinessProbe:
                        httpGet:
                            path: /health/readiness
                            port: 8080
                        initialDelaySeconds: 15
                        periodSeconds: 15
                    resources:
                        requests:
                            cpu: "0.25"
                            memory: "512Mi"
                    ports:
                        -   containerPort: 8080
                    env:
                        -   name: LIGHTER_KUBERNETES_ENABLED
                            value: "true"
                        # -   name: LIGHTER_STORAGE_JDBC_USERNAME
                        #     value: postgres
                        # -   name: LIGHTER_STORAGE_JDBC_PASSWORD
                        #     value: JDfQeUq4Dl
                        # -   name: LIGHTER_STORAGE_JDBC_URL
                        #     value: jdbc:postgresql://lighter-psql-postgresql.spark.svc.cluster.local:5432/lighter
                        # -   name: LIGHTER_STORAGE_JDBC_DRIVER_CLASS_NAME
                        #     value: org.postgresql.Driver
                        -   name: LIGHTER_MAX_RUNNING_JOBS
                            value: "15"
            serviceAccountName: spark